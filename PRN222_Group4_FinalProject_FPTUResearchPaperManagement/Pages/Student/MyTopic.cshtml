@page
@model PRN222_Group4_FinalProject_FPTUResearchPaperManagement.Pages.Student.MyTopicModel
@{
    ViewBag.ShowSidebar = true;
    ViewBag.ActiveMenu = "MyTopic";
}

<div class="container-fluid px-0 my-4">
    <h3 class="mb-4">Đề Tài Đã Đăng Ký</h3>

    @if (Model.RegisteredTopic == null)
    {
        <div class="text-center my-5">
            <img src="~/assets/empty_box.png" style="width:150px; opacity:0.8;" />
            <p class="mt-3 text-muted">Bạn chưa đăng ký đề tài nào.</p>
        </div>
    }
    else
    {
        <div class="card shadow-sm rounded p-3 topic-card d-flex flex-row gap-3">
            <!-- Left: Topic details + members -->
            <div class="flex-fill border-end pe-3">
                <h4>@Model.RegisteredTopic.Title</h4>
                <p>
                    <strong>Chuyên ngành:</strong> @Model.RegisteredTopic.Major <br />
                    <strong>Học kỳ:</strong> @Model.RegisteredTopic.SemesterTerm <br />
                </p>

                @if (Model.RegisteredTopic.Members.Any())
                {
                    <p><strong>Thành viên:</strong></p>
                    <ul>
                        @foreach (var m in Model.RegisteredTopic.Members)
                        {
                            <li>
                                @m.Full_Name
                                @if (m.IsLeader)
                                {
                                    <span class="badge bg-warning text-dark ms-1">⭐ Nhóm trưởng</span>
                                }
                            </li>
                        }
                    </ul>
                }
            </div>

            <!-- Right: Submission Instructions + Countdown -->
            <div class="flex-fill ps-3 d-flex flex-column justify-content-between">
                <div>
                    <h5>Hướng dẫn nộp bài</h5>
                    <p><strong>@Model.RegisteredTopic.SubmissionInstruction</strong></p>
                </div>
                <div class="mt-3 text-center">
                    <h6>Hạn nộp còn lại:</h6>
                    <div id="countdown" class="fs-5 fw-bold"></div>
                </div>
            </div>
        </div>
    }
</div>

<div class="container-fluid mt-4 px-0">
    <div class="p-4 bg-white shadow-sm rounded">
        <h4>Nội dung bổ sung</h4>
        <p class="text-muted">Thêm thông tin ở đây…</p>
    </div>
</div>

<style>
    .topic-card {
        background-color: #fff;
    }

    #countdown span {
        display: inline-block;
        min-width: 40px;
    }
</style>

<script>
    @* Countdown Timer *@
    const deadline = new Date("@Model.RegisteredTopic?.Deadline_Date.ToString("yyyy-MM-ddTHH:mm:ss")").getTime();

    const countdownEl = document.getElementById("countdown");

    if(deadline){
        const timer = setInterval(function() {
            const now = new Date().getTime();
            const distance = deadline - now;

            if (distance < 0) {
                clearInterval(timer);
                countdownEl.innerHTML = "Hết hạn!";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownEl.innerHTML =
                (days > 0 ? days + " ngày " : "") +
                String(hours).padStart(2,'0') + " : " +
                String(minutes).padStart(2,'0') + " : " +
                String(seconds).padStart(2,'0');
        }, 1000);
    }
</script>
